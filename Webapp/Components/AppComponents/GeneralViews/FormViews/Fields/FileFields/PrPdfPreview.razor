@using Domain.PurchaseRequests.Dto
@using Domain.PurchaseRequests.Pdf
@using QuestPDF.Fluent

@*<embed type="application/pdf" 
       src="@this._embededSrc"  
        width="100%" height="100%"/>*@
@if (this.PurchaseRequestInput?.TempFile != null) {
    <PdfPreview FileBytes="@this.PurchaseRequestInput.TempFile"></PdfPreview>
}


@code {
    [Inject] private IWebHostEnvironment _environment { get; set; }
    [Parameter] public PurchaseRequestInput? PurchaseRequestInput { get; set; }
    private bool _prNull = true;
    private byte[]? _fileBytes;
    //private string _embededSrc = string.Empty;
     protected override async Task OnInitializedAsync() {
        await base.OnInitializedAsync();
     }

     protected override async Task OnParametersSetAsync() {
         await base.OnParametersSetAsync();
         
         if(this.PurchaseRequestInput != null) {
             if (this._prNull) {
                 var document = new PurchaseRequestDocument(this.PurchaseRequestInput,Path.Combine($"{this._environment.WebRootPath}","images/seti_logo.png"));
                 this.PurchaseRequestInput.TempFile=document.GeneratePdf();
                 //this._embededSrc = "data:application/pdf;base64," + Convert.ToBase64String(this.PurchaseRequestInput.TempFile)+"#zoom=75%";
                 this._prNull = false;
             }
         } else {
             this._prNull = true;
         }
     }
}